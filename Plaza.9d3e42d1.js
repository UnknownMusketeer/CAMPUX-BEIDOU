import{b6 as R,i as S,Z as d,a9 as _,aZ as T,a1 as e,a0 as t,U as z,a2 as r,V as C,a5 as u,a6 as x,a3 as L,Q as I,W as A,aj as M,a_ as N,at as V,$ as Q,al as j,ak as D,b9 as O,ba as H,w as y,a as Z,x as F,b8 as v,am as g,b7 as W}from"./index.53118d9a.js";import{Q as G}from"./QSpinnerDots.1fc23977.js";import{Q as J}from"./QInfiniteScroll.4e8202dd.js";import{a as K,d as X}from"./QAvatar.228b257b.js";window.CESIUM_BASE_URL="/cesium/";const Y=c=>(O("data-v-a725920c"),c=c(),H(),c),ee=["onClick"],te=["src"],ae={class:"row justify-center q-pt-xs"},se={class:"col-4 col-sm-2",style:{width:"auto"}},oe={class:"row q-px-md q-mb-sm"},le={class:"col-12",style:{"font-size":"14px"}},ie={key:0,class:"col-12"},ne=Y(()=>r("div",{class:"absolute-full flex flex-center bg-dark text-white"},null,-1)),re={class:"absolute-full flex flex-center bg-grey-5 text-white"},de={__name:"PostList",props:{posts:{type:Object}},setup(c){const l=S("hidePlaza"),s=S("flyPinLocation");function b(a){console.log("go pin Location"),s(a),l()}return(a,n)=>(d(!0),_(V,null,T(c.posts,o=>(d(),_("div",{key:o,onClick:f=>b(o.pinId),style:{"border-top":"0.001rem solid lightgrey"},class:"q-pb-xs"},[e(A,{class:"q-pt-sm q-pl-md q-pr-sm q-py-xs",dense:""},{default:t(()=>[e(z,{side:"",style:{"justify-content":"start"}},{default:t(()=>[e(K,{size:"34px"},{default:t(()=>[r("img",{src:o.author.avatar,loading:"lazy"},null,8,te)]),_:2},1024)]),_:2},1024),e(z,null,{default:t(()=>[e(C,{style:{"font-size":"13px","font-weight":"500"}},{default:t(()=>[u(x(o.author.name),1)]),_:2},1024),e(C,{caption:"",lines:"1",style:{"margin-top":"2px"}},{default:t(()=>[u(x(o.created_time),1)]),_:2},1024)]),_:2},1024),e(z,{side:"",top:""},{default:t(()=>[e(C,null,{default:t(()=>[r("div",ae,[r("div",se,[e(L,{class:"text-dark q-px-sm",size:"9px",padding:"xs",flat:"",ripple:!1,disabled:""},{default:t(()=>[e(I,{name:"r_favorite_border",class:"q-pr-xs"}),r("div",null,x(o.like_count),1)]),_:2},1024),e(L,{class:"text-dark q-px-sm",size:"9px",flat:"",padding:"xs",ripple:!1,disabled:""},{default:t(()=>[e(I,{name:"chat_bubble_outline",class:"q-pr-xs"}),r("div",null,x(o.comment_count),1)]),_:2},1024)])])]),_:2},1024)]),_:2},1024)]),_:2},1024),r("div",oe,[r("div",le,x(o.content),1),o.images.length==0?(d(),_("div",ie,[e(M(N),{type:"video",source:o.video[0].video,radius:"1rem","hide-volume-slider":"",dense:"","hide-settings-btn":"","hide-volume-btn":"","hide-play-btn":"","show-spinner":!1,"content-style":"max-height:180px",style:{"--mediaplayer-color":"#fff","--mediaplayer-color-dark":"#fff",position:"sticky",top:"8px","z-index":"1000"}},null,8,["source"])])):(d(!0),_(V,{key:1},T(o.images,(f,m)=>(d(),_("div",{class:"col-3 q-pr-xs border q-pt-xs",key:f},[m<3?(d(),Q(j,{key:0,src:f.image,ratio:1,onClick:k=>{a.carousel=!0,a.slide=m},loading:"lazy",style:{"border-radius":"1rem"}},{error:t(()=>[ne]),_:2},1032,["src","onClick"])):D("",!0),m==3?(d(),Q(j,{key:1,src:"",ratio:1,onClick:k=>{a.carousel=!0,a.slide=m},style:{"border-radius":"1rem"}},{default:t(()=>[r("div",re,[e(I,{name:"more_horiz",class:"q-pr-xs",size:"40px"})])]),_:2},1032,["onClick"])):D("",!0)]))),128))])],8,ee))),128))}},ce=R(de,[["__scopeId","data-v-a725920c"]]),ue={class:"row justify-center q-my-md"},fe={__name:"PlazaContent",props:{tag:{type:String,required:!0}},setup(c){const l=c,s=y([]),b=Z(()=>l.tag),n=localStorage.getItem("username.caucx");function o(w){let h=[],q=new Date().getTime()/1e3;for(let i of w){let P=new Date(i.created_time),B=P.getTime()/1e3,p=q-B;if(p<60)i.created_time=`${parseInt(p)}\u79D2\u524D`;else if(p<3600)i.created_time=`${parseInt(p/60)}\u5206\u949F\u524D`;else if(p>3600&&p<3600*24)i.created_time=`${parseInt(p/3600)}\u5C0F\u65F6\u524D`;else{let U=P.getDate(),E=P.getMonth();i.created_time=`${E+1}-${U}`}i.content=i.content.substr(0,40)+"...",h.push(i)}return h}const f=y(0);function m(w,h){console.log("make request"),console.log(`index: ${w}`),X.get("http://127.0.0.1:8000/api/campus/posts/?username="+n+"&offset="+f.value+"&limit=3&tag="+b.value).then(q=>{let i=q.data.results;if(console.log(i),s.value.push(...o(i)),f.value+=3,i.length<3){h(!0);return}h()})}const k=y(null),$=y(null);return F(b,()=>{s.value=[],f.value=0,console.log($.value),$.value.index=0}),(w,h)=>(d(),_("div",{style:{height:"66vh",overflow:"auto"},ref_key:"scrollTargetRef",ref:k},[e(J,{onLoad:m,offset:50,ref_key:"infiniteScrollRef",ref:$,"scroll-target":k.value,class:"bg-white q-pa-none q-ma-none"},{loading:t(()=>[r("div",ue,[e(G,{color:"primary",size:"40px"})])]),default:t(()=>[e(ce,{posts:s.value},null,8,["posts"])]),_:1},8,["scroll-target"])],512))}};const pe={style:{width:"85vw",height:"70vh"},class:"bg-white absolute"},_e=u("\u5E7F\u573A"),me=u("\u6D3B\u52A8"),he=u("\u95EE\u7B54"),ve=u("\u5410\u69FD"),ge=u("\u6C42\u52A9"),ye=u("\u635E\u4EBA"),$e={__name:"Plaza",setup(c){const l=y(""),s=y("plaza");return(b,a)=>(d(),_("div",pe,[(d(),Q(fe,{tag:l.value,key:l.value},null,8,["tag"])),e(W,{modelValue:s.value,"onUpdate:modelValue":a[6]||(a[6]=n=>s.value=n),dense:"",class:"text-grey absolute-bottom","active-color":"green-6","indicator-color":"green-7",align:"justify","inline-label":"","mobile-arrows":""},{default:t(()=>[e(v,{name:"plaza",ripple:!1,onClick:a[0]||(a[0]=n=>{s.value="plaza",l.value=""}),icon:"lens_blur"},{default:t(()=>[e(g,{"transition-show":"","transition-hide":"fade","hide-delay":550,anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:t(()=>[_e]),_:1})]),_:1}),e(v,{name:"activity",ripple:!1,onClick:a[1]||(a[1]=n=>{s.value="activity",l.value="1"}),icon:"o_pin_drop"},{default:t(()=>[e(g,{"transition-show":"","transition-hide":"fade","hide-delay":550,anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:t(()=>[me]),_:1})]),_:1}),e(v,{name:"question",ripple:!1,onClick:a[2]||(a[2]=n=>{s.value="question",l.value="2"}),icon:"o_not_listed_location"},{default:t(()=>[e(g,{"transition-show":"","transition-hide":"fade","hide-delay":550,anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:t(()=>[he]),_:1})]),_:1}),e(v,{name:"complain",ripple:!1,onClick:a[3]||(a[3]=n=>{s.value="complain",l.value="3"}),icon:"tag_faces"},{default:t(()=>[e(g,{"transition-show":"","transition-hide":"fade","hide-delay":550,anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:t(()=>[ve]),_:1})]),_:1}),e(v,{name:"help",ripple:!1,onClick:a[4]||(a[4]=n=>{s.value="help",l.value="4"}),icon:"accessibility_new"},{default:t(()=>[e(g,{"transition-show":"","transition-hide":"fade","hide-delay":550,anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:t(()=>[ge]),_:1})]),_:1}),e(v,{name:"findPeople",ripple:!1,onClick:a[5]||(a[5]=n=>{s.value="findPeople",l.value="5"}),icon:"person_search"},{default:t(()=>[e(g,{"transition-show":"","transition-hide":"fade","hide-delay":550,anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:t(()=>[ye]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{$e as default};
